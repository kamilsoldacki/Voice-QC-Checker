<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Conversational Voice Tester</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background-color: #f9f9f9;
      color: #1c1c1e;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem;
    }

    .container {
      width: 100%;
      max-width: 600px;
    }

    header {
      width: 100%;
      font-weight: bold;
      font-size: 1.2rem;
      padding-bottom: 0.5rem;
    }

    .card {
      background-color: white;
      padding: 2rem;
      border-radius: 16px;
      box-shadow: 0 4px 14px rgba(0,0,0,0.08);
      width: 100%;
      margin-top: 1rem;
    }

    .card h1 {
      font-size: 1.25rem;
      margin-bottom: 0.5rem;
    }

    .card p {
      font-size: 0.9rem;
      color: #555;
      margin-bottom: 1rem;
    }

    label {
      font-weight: 500;
      display: block;
      margin: 1rem 0 0.3rem;
    }

    input, select {
      width: 100%;
      padding: 0.6rem 0.75rem;
      font-size: 1rem;
      border-radius: 8px;
      border: 1px solid #ccc;
      margin-bottom: 0.5rem;
    }

    .flex-row {
      display: flex;
      gap: 1rem;
      align-items: flex-end;
      margin-bottom: 1rem;
    }

    .flex-row label {
      flex: 1;
    }

    .fixed-width {
      width: 150px;
    }

    button {
      width: 100%;
      margin-top: 1.5rem;
      padding: 0.75rem;
      background-color: black;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
    }

    .loading {
      text-align: center;
      font-size: 0.95rem;
      color: #666;
      margin-top: 2rem;
    }

    .results {
      margin-top: 2rem;
      width: 100%;
    }

    .dialogue-line {
      font-size: 0.95rem;
      color: #333;
      margin-bottom: 0.5rem;
    }

    .audio-wrapper {
      margin-top: 2rem;
      background-color: #f7f7f7;
      border-radius: 12px;
      padding: 1rem;
    }

    audio {
      width: 100%;
    }

    footer {
      margin-top: 2rem;
      font-size: 0.8rem;
      color: #777;
      text-align: center;
    }

    .card h2 {
      font-size: 1rem;
      font-weight: bold;
      margin-top: 1.5rem;
      margin-bottom: 0.75rem;
      color: #1c1c1e;
    }

    @media (max-width: 600px) {
      .card {
        padding: 1rem;
      }

      .flex-row {
        flex-direction: column;
        align-items: stretch;
      }

      .fixed-width {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>IIElevenLabs</header>

    <div class="card">
      <p>Test the chemistry between voices from the Voice Library in a natural dialogue and hear how they interact.</p>
      <form id="dialogForm">

        <!-- Voice A -->
        <div class="flex-row">
          <label>
            Voice ID A
            <input type="text" id="voiceA" required />
          </label>
          <label class="fixed-width">
            Segments Length
            <select id="lengthA">
              <option value="short">short</option>
              <option value="long">long</option>
            </select>
          </label>
        </div>

        <!-- Voice B -->
        <div class="flex-row">
          <label>
            Voice ID B
            <input type="text" id="voiceB" required />
          </label>
          <label class="fixed-width">
            Segments Length
            <select id="lengthB">
              <option value="short">short</option>
              <option value="long">long</option>
            </select>
          </label>
        </div>

        <!-- Model -->
        <label for="model">Model</label>
        <select id="model" required>
          <option value="eleven_v3">eleven_v3</option>
          <option value="eleven_multilingual_v2" selected>eleven_multilingual_v2</option>
          <option value="eleven_flash_v2_5">eleven_flash_v2_5</option>
          <option value="eleven_turbo_v2">eleven_turbo_v2</option>
        </select>

        <!-- Topic -->
        <label for="topic">Topic (e.g. ordering coffee, talking about weather, support service)</label>
        <input type="text" id="topic" required />

        <!-- Submit -->
        <button type="submit">Generate</button>
      </form>

      <div class="results" id="result"></div>
    </div>

    <footer>
      Built with ❤️ for the ElevenLabs team · Kamil Soldacki
    </footer>
  </div>

  <script>
    document.getElementById("dialogForm").addEventListener("submit", async (e) => {
      e.preventDefault();

      const button = e.submitter;
      button.disabled = true;
      button.textContent = "Writing the conversation & generating audio... Just a moment.";

      const voiceIdA = document.getElementById("voiceA").value;
      const voiceIdB = document.getElementById("voiceB").value;
      const lengthA = document.getElementById("lengthA").value;
      const lengthB = document.getElementById("lengthB").value;
      const model = document.getElementById("model").value;
      const topic = document.getElementById("topic").value;

      const res = await fetch("/api/conversation", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ voiceIdA, voiceIdB, topic, model, lengthA, lengthB })
      });

      const data = await res.json();
      const container = document.getElementById("result");
      container.innerHTML = "";

      const dialogueHeader = document.createElement("h2");
      dialogueHeader.textContent = "Script:";
      container.appendChild(dialogueHeader);

      data.dialogue.forEach((line) => {
        const p = document.createElement("p");
        p.className = "dialogue-line";
        p.textContent = `${line.speaker}: ${line.text}`;
        container.appendChild(p);
      });

      if (data.combined_audio_url) {
        const audioWrapper = document.createElement("div");
        audioWrapper.className = "audio-wrapper";

        const audioHeader = document.createElement("h2");
        audioHeader.textContent = "Take a listen:";

        const audio = document.createElement("audio");
        audio.controls = true;
        audio.src = data.combined_audio_url;

        audioWrapper.appendChild(audioHeader);
        audioWrapper.appendChild(audio);
        container.appendChild(audioWrapper);
      }

      button.disabled = false;
      button.textContent = "Generate";
    });
  </script>
</body>
</html>
